{% include 'panels/columns_selector_panel.jinja2' %}
<div class="nav">
    <div style="float:left;">Fetched <b>{{ n_rows }}</b> in <b>{{ elapsed_time }}</b> sec</div>
    <form>
        Results per page
        <select id="nPerPage">
            <option {% if result_per_page==10 %} selected {% endif %}>10</option>
            <option {% if result_per_page==20 %} selected {% endif %}>20</option>
            <option {% if result_per_page==30 %} selected {% endif %}>30</option>
            <option {% if result_per_page==40 %} selected {% endif %}>40</option>
            <option {% if result_per_page==50 %} selected {% endif %}>50</option>
            <option {% if result_per_page==100 %} selected {% endif %}>100</option>
        </select>
        Page:<input id="pageSel" type="number" placeholder="page" value="{{ curr_page + 1}}" max="{{ max_pages }}" style="width:70px;"/>
        </select> of {{ max_pages }}
    </form>
</div>
<script>
    $('#pageSel').change(function() {
        currPage = $(this).val()-1;
        search();
    });

    $('#nPerPage').change(function () {
        currPage=0;
        result_per_page = $(this).val();
        search();
    });
</script>
<table id="resultTbl" class="ui table segment">
    <tr>
        <th style="width:32px;">Detail</th>
        {% for col in normal_columns %}
            <th style="white-space: nowrap;">
                <a class="colLnk" href="{{ col }}"> {{ col }}</a>
                {% if order['column'] == col %}
                    {% if order['ascending'] %}
                        <i class="sort ascending icon"></i>
                    {% else %}
                        <i class="sort descending icon"></i>
                    {% endif %}
                {% endif %}
                <i class="choiceColumnLnk add icon"></i>
            </th>
        {% endfor %}
        {% for col in tag_columns %}
            <th style="white-space: nowrap;">
                <a class="colLnk" href="_tags.{{ col }}">#{{ col }}</a>
                {% if order['column'] == '_tags.'+col %}
                    {% if order['ascending'] %}
                        <i class="sort ascending icon"></i>
                    {% else %}
                        <i class="sort descending icon"></i>
                    {% endif %}
                {% endif %}
                <i class="choiceColumnLnk add icon"></i>
            </th>
        {% endfor %}
    </tr>
    <script>
        $('.choiceColumnLnk').click(function(){
            if (!$("#columSelectorPanel").is(":visible")) {
                var pos = $(this).position();
                var width = $(this).outerWidth();
                $("#columSelectorPanel").css({
                    position: "absolute",
                    top: pos.top + "px",
                    left: (pos.left + 40) + "px"
                }).show("slide", {direction: "up"}, 300);
            }else{
                $("#columSelectorPanel").hide("slide", {direction: "down"}, 300);
            }
        });
    </script>
    <tbody>
    {% for log in logs %}
        <tr>
            <td style="width:32px;">
                <a href="{{ 'detail' | route_url }}?id={{ log['_id'] }}">
                    {% if '_stack_hash' in log %}
                        <img src="{{ 'log4all:static/images/32x32/stack.png'|static_url }}" title="Stack Detail"
                             border="0">
                    {% else %}
                        <img src="{{ 'log4all:static/images/32x32/info.png'|static_url }}" title="Detail"
                             border="0">
                    {% endif %}
                </a>
            </td>
            {% for col in normal_columns %}
                {% if col != 'date' %}
                <td>
                    <a href="#" onclick="searchTag('{{ col }}=\x22{{ log[col] }}\x22');">
                        {{ log[col] }}
                    </a>
                </td>
                {% else %}
                    <td>
                        {{ log[col] }}
                    </td>
                {% endif %}
            {% endfor %}
            {% for col in tag_columns %}
                <td>
                    <a href="#" onclick="searchTag('#{{ col }}=\x22{{ log['_tags'][col] }}\x22');">
                        {{ log['_tags'][col] }}
                    </a>
                </td>
            {% endfor %}
        </tr>
    {% endfor %}
    </tbody>
</table>

<script>
    $('.colLnk').click(function (event) {
        event.preventDefault();
        var colname = $(this).attr('href');
        if (order['column'] == null || order['column'] != colname) {
            order['column'] = colname;
            order['ascending'] = true;
        } else {
            if (order['ascending'] == null) {
                order['ascending'] = true;
            } else {
                order['ascending'] = !order['ascending'];
            }
        }
        search();
    });
</script>