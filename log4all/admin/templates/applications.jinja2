{% extends 'admin_layout.jinja2' %}
{% block center %}

    {% if error_message %}
        {% import 'log4all:templates/util/dialogs.jinja2' as dialogs %}
        {% call dialogs.error_dialog('Error',error_message) %}
        {% endcall %}
    {% endif %}


    <div id="delAppModal" class="ui modal">
        <div class="header">
            Delete Application
        </div>
        <div class="content">
            Are you sure to delete the application <b><span id="delAppNameLbl"></span></b></br></br>
            <form id="delAppFrm" method="POST">
                <input type="hidden" name="operation" value="delApplication">
                <input type="hidden" name="csrf" value="{{ csrf }}">
                <input type="hidden" name="name" id="delAppNameFld">

                <div id="deleteAppBtn" class="ui red submit button ">Delete</div>
                <div id="cancelDeleteAppBtn" class="ui button">Cancel</div>
                <script>
                    $("#cancelDeleteAppBtn").click(function () {
                        $('#delAppModal').modal('hide');
                    });
                    $("#deleteAppBtn").click(function () {
                        $('#delAppFrm').submit();
                    });
                </script>
            </form>
        </div>
    </div>

    <script>
        function deleteApplication(name) {
            $('#delAppNameLbl').html(name);
            $('#delAppNameFld').val(name);
            $('#delAppModal').modal('show');
        }
    </script>


    <div class="panel">
        <div class="title">Applications</div>
        <div class="contentPanel">
            <table id="applicationTable" class="ui table segment">
                <thead>
                <tr>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                {% for application in applications %}
                    <tr>
                        <td>{{ application['name'] }}</td>
                        <td>{{ application['description'] }}</td>
                        <td>
                            <a href="{{ 'admin_edit_application'|route_url }}?idApp={{ application['_id'] }}"
                               style="text-decoration: none;">
                                <i class="edit big icon link" title="Edit group"></i>
                            </a>
                            <i class="delete red big  icon link" title="Delete application"
                               onclick="deleteApplication('{{ application['name'] }}');"></i>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
                <tfoot>
                <tr>
                    <th colspan="3">
                        <div id="addApplicationBtn" class="ui green labeled icon button"><i class="desktop icon"></i>
                            Add Application
                        </div>
                        <script>
                            $('#addApplicationBtn').click(function(){
                                 $('#addApplicationModal').modal('show');
                            });
                        </script>
                    </th>
                </tr>
                </tfoot>
            </table>
        </div>
    </div>
    <div id="addApplicationModal" class="ui modal">
        <div class="header">
            Add Application
        </div>
        <div class="ui form segment">
            <form id="addApplicationFrm" method="POST">
                <input type="hidden" name="csrf" value="{{ csrf }}">
                <input type="hidden" name="operation" value="addApplication">
                <div class="field">
                    <label>Application Name</label>
                    <input name="name" type="text" placeholder="Application Name">
                </div>
                <div class="field">
                    <label>Application Description</label>
                    <textarea name="description" placeholder="Application Description"></textarea>
                </div>
                <div id="saveApplicationBtn" class="ui green submit button">Add</div>
                <div id="cancelApplicationBtn" class="ui button">Cancel</div>
                <div id="fbPanel" style="padding: 5px;color: red;"></div>
            </form>
            <script>
                $("#cancelApplicationBtn").click(function () {
                    $('#addApplicationModal').modal('hide');
                });
                $("#saveApplicationBtn").click(function () {
                    $('#addApplicationFrm').submit();
                });
            </script>
        </div>
    </div>
{% endblock %}